<app-confirm
  [message]="confirmMessage"
  [show]="showConfirm"
  (confirmed)="onConfirmLogout()"
  (cancelled)="onCancelLogout()"
></app-confirm>

<!-- Sidebar -->
<div
  class="sidebar bg-light shadow-sm d-flex flex-column justify-content-between p-3"
  [ngClass]="{ collapsed: isCollapsed }"
>
  <!-- Header (Logo + Toggle Button + Navigation) -->
  <div>
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="fw-bold text-dark m-0" *ngIf="!isCollapsed">InvSys</h4>
      <button class="btn menu-btn" (click)="toggleSidebar()">â˜°</button>
    </div>

    <!-- Navigation Buttons (moved just below header) -->
    <div class="d-flex flex-column mt-2" *ngIf="!isCollapsed">
      <button
        class="btn menu-btn mb-2 text-start"
        [ngClass]="{ active: activeMenu === 'dashboard' }"
        (click)="setActive('dashboard'); navigateTo(`${user.role}/dashboard`)"
      >
        Dashboard
      </button>

      <!-- Parent Button -->
      <button
        class="btn btn-outline-dark menu-btn mb-2 text-start w-100"
        [ngClass]="{ active: activeMenu === 'products and categories' }"
        *ngIf="user.role === 'superadmin' || user.role === 'admin' || user.role === 'employee'"
        (click)="setActive('products and categories'); toggleProductsDropdown()"
      >
        Products & Categories
      </button>

      <!-- Dropdown Buttons -->
      <div *ngIf="showProductsDropdown && !isCollapsed" class="ms-3">
        <button
          class="btn menu-btn mb-2 text-start w-100"
          [ngClass]="{ active: activeMenu === 'manage products' }"
          (click)="setActive('manage products'); navigateTo(`${user.role}/products`)"
        >
          Manage Products
        </button>
        <button
          class="btn menu-btn text-start w-100 mb-2"
          [ngClass]="{ active: activeMenu === 'manage categories' }"
          (click)="setActive('manage categories'); navigateTo(`${user.role}/categories`)"
        >
          Manage Categories
        </button>
      </div>

      <button
        class="btn menu-btn mb-2 text-start"
        [ngClass]="{ active: activeMenu === 'products' }"
        *ngIf="user.role === 'customer'"
        (click)="setActive('products'); navigateTo(`${user.role}/products`)"
      >
        Products
      </button>

      <button
        class="btn menu-btn mb-2 text-start"
        [ngClass]="{ active: activeMenu === 'my orders' }"
        *ngIf="user.role === 'customer'"
        (click)="setActive('my orders'); navigateTo(`${user.role}/orders`)"
      >
        My Orders
      </button>

      <button
        class="btn menu-btn mb-2 text-start"
        [ngClass]="{ active: activeMenu === 'orders' }"
        *ngIf="user.role === 'superadmin' || user.role === 'admin' || user.role === 'employee'"
        (click)="setActive('orders'); toggleOrdersDropdown()"
      >
        Orders
      </button>

      <!-- Dropdown Buttons -->
      <div *ngIf="showOrdersDropdown && !isCollapsed" class="ms-3">
        <button
          class="btn menu-btn mb-2 text-start w-100"
          [ngClass]="{ active: activeMenu === 'manage purchases' }"
          (click)="setActive('manage purchases'); navigateTo(`${user.role}/purchaseorders`)"
        >
          Manage Purchases
        </button>
        <button
          class="btn menu-btn text-start w-100 mb-2"
          [ngClass]="{ active: activeMenu === 'manage sales' }"
          (click)="setActive('manage sales'); navigateTo(`${user.role}/sales`)"
        >
          Manage Sales
        </button>
      </div>

      <button
        class="btn menu-btn mb-2 text-start"
        [ngClass]="{ active: activeMenu === 'users' }"
        *ngIf="user.role === 'superadmin' || user.role === 'admin'"
        (click)="setActive('users'); navigateTo(`${user.role}/users`)"
      >
        Users
      </button>
    </div>
  </div>

  <!-- Footer (User + Logout) -->
  <div class="mt-4 border-top pt-3" *ngIf="!isCollapsed">
    <div class="d-flex align-items-center">
      <div
        class="rounded-circle bg-secondary text-white d-flex justify-content-center align-items-center me-2"
        style="width: 35px; height: 35px"
      >
        {{user?.firstName?.charAt(0).toUpperCase()}}
      </div>
      <div>
        <a
          class="d-block fw-bold text-dark text-decoration-none"
          (click)="navigateTo('/profile')"
          style="cursor: pointer"
        >
          {{user.firstName}} {{user.lastName}}
        </a>

        <button (click)="logout()" class="btn btn-link text-primary p-0" style="z-index: 9999;">
          Log Out
        </button>
      </div>
    </div>
  </div>
</div>
